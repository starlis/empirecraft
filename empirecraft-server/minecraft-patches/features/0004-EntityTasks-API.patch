From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Aikar <aikar@aikar.co>
Date: Tue, 11 Jun 2013 23:15:00 -0400
Subject: [PATCH] EntityTasks API

Allows scheduling repeating task timers on an entity level.
Avoids Bukkit system so that tasks will simply maintain themselves on entity removal.

diff --git a/net/minecraft/server/level/ServerLevel.java b/net/minecraft/server/level/ServerLevel.java
index ab5efa15a1f56feda7d3e91009a517e98216e734..49e663e11a51f38ae56b0f2dbfa673914030b3c8 100644
--- a/net/minecraft/server/level/ServerLevel.java
+++ b/net/minecraft/server/level/ServerLevel.java
@@ -1347,6 +1347,7 @@ public class ServerLevel extends Level implements ServerEntityGetter, WorldGenLe
         ProfilerFiller profilerFiller = Profiler.get();
         entity.tickCount++;
         entity.totalEntityAge++; // Paper - age-like counter for all entities
+        com.empireminecraft.empirecraft.api.EntityTasksHandler.tickHandler(entity); // EMC - EntityTasks API
         profilerFiller.push(() -> BuiltInRegistries.ENTITY_TYPE.getKey(entity.getType()).toString());
         profilerFiller.incrementCounter("tickNonPassenger");
         final boolean isActive = io.papermc.paper.entity.activation.ActivationRange.checkIfActive(entity); // Paper - EAR 2
@@ -1375,6 +1376,7 @@ public class ServerLevel extends Level implements ServerEntityGetter, WorldGenLe
             passengerEntity.setOldPosAndRot();
             passengerEntity.tickCount++;
             passengerEntity.totalEntityAge++; // Paper - age-like counter for all entities
+            com.empireminecraft.empirecraft.api.EntityTasksHandler.tickHandler(passengerEntity); // EMC - EntityTasks API
             ProfilerFiller profilerFiller = Profiler.get();
             profilerFiller.push(() -> BuiltInRegistries.ENTITY_TYPE.getKey(passengerEntity.getType()).toString());
             profilerFiller.incrementCounter("tickPassenger");
diff --git a/net/minecraft/world/entity/Entity.java b/net/minecraft/world/entity/Entity.java
index 8b6d210b0193740b261d671359baec9e6af9f206..30f79c7d4020897f6a53d0f598793171985676c1 100644
--- a/net/minecraft/world/entity/Entity.java
+++ b/net/minecraft/world/entity/Entity.java
@@ -159,6 +159,7 @@ public abstract class Entity implements SyncedDataHolder, DebugValueSource, Name
         return input.getIntOr("Bukkit.updateLevel", CURRENT_LEVEL) >= level;
     }
     public final java.util.Map<org.bukkit.NamespacedKey, Object> tempMeta = com.google.common.collect.Maps.newHashMap(); // EMC - Temporary Meta API
+    public com.empireminecraft.empirecraft.api.EntityTasksHandler.TaskList entityTasks = new com.empireminecraft.empirecraft.api.EntityTasksHandler.TaskList(); // EMC - EntityTasks API
 
     // Paper start - Share random for entities to make them more random
     public static RandomSource SHARED_RANDOM = new RandomRandomSource();
